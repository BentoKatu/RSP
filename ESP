--[[
ESP Arsenal - Box, Vida, Distância, Team Check (PlayerGui)
Por: DeepSeek
]]

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local PlayerGui = LocalPlayer:FindFirstChild("PlayerGui") or LocalPlayer:WaitForChild("PlayerGui")

local ESP_ACTIVE = true
local ENEMY_COLOR = Color3.fromRGB(255,70,70)
local UI_NAME = "DeepSeek_ESP_UI"
local ESP_TAG = "_DeepSeekESP"

-- Remove elementos antigos
local function clearESP()
    for _, v in ipairs(PlayerGui:GetChildren()) do
        if v.Name:find(ESP_TAG) then
            v:Destroy()
        end
    end
end

-- Interface simples para toggle
local function setupUI()
    if PlayerGui:FindFirstChild(UI_NAME) then return end
    local gui = Instance.new("ScreenGui", PlayerGui)
    gui.Name = UI_NAME
    local btn = Instance.new("TextButton", gui)
    btn.Size = UDim2.new(0, 160, 0, 36)
    btn.Position = UDim2.new(0, 12, 0, 10)
    btn.BackgroundColor3 = Color3.fromRGB(32,32,32)
    btn.TextColor3 = Color3.fromRGB(220,220,220)
    btn.TextSize = 18
    btn.Font = Enum.Font.GothamBold
    btn.Text = "ESP: ON"
    btn.MouseButton1Click:Connect(function()
        ESP_ACTIVE = not ESP_ACTIVE
        btn.Text = "ESP: " .. (ESP_ACTIVE and "ON" or "OFF")
    end)
end

-- Calcula distância em metros
local function getDistance(pos)
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return 0 end
    return math.floor((char.HumanoidRootPart.Position - pos).Magnitude)
end

-- Desenha o ESP de caixa com informações
local function drawBoxESP(character, name, health, distance)
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    local hrp = character.HumanoidRootPart

    local screenPos, visible = Camera:WorldToViewportPoint(hrp.Position)
    if not visible then return end

    -- Caixa simples (posição fixa para debug, para ver se aparece algo)
    local box = Instance.new("Frame")
    box.Name = name..ESP_TAG
    box.Parent = PlayerGui
    box.BackgroundTransparency = 0.8
    box.BorderSizePixel = 2
    box.BorderColor3 = ENEMY_COLOR
    box.BackgroundColor3 = Color3.fromRGB(0,0,0)
    box.Position = UDim2.new(0, screenPos.X-50, 0, screenPos.Y-80)
    box.Size = UDim2.new(0, 100, 0, 120)

    local info = Instance.new("TextLabel", box)
    info.BackgroundTransparency = 1
    info.Size = UDim2.new(1,0,0,18)
    info.Position = UDim2.new(0,0,0,-18)
    info.Font = Enum.Font.GothamSemibold
    info.TextSize = 13
    info.TextStrokeTransparency = 0.35
    info.TextColor3 = ENEMY_COLOR
    info.Text = string.format("%s | Vida: %d | %dm", name, health, distance)
end

local function showESP()
    clearESP()
    if not ESP_ACTIVE then return end
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and p.Character:FindFirstChildOfClass("Humanoid") then
            if p.Team ~= LocalPlayer.Team then
                local dist = getDistance(p.Character.HumanoidRootPart.Position)
                local health = math.floor(p.Character:FindFirstChildOfClass("Humanoid").Health)
                drawBoxESP(p.Character, p.Name, health, dist)
            end
        end
    end
end

setupUI()
RunService.RenderStepped:Connect(showESP)
