-- Roblox Arsenal ESP + Aimbot completo com menu funcional, FOV circular visível e mira só em inimigos visíveis
-- ESP: caixas azuis para aliados, vermelhas para inimigos
-- Aimbot: mira inimigos dentro do círculo de FOV e que estejam visíveis (sem obstáculos)
-- AVISO: Uso em jogos pode violar Termos de Serviço e resultar em banimento.

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = workspace

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- Criar ScreenGui e evitar sumir após respawn
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "EnhancedESP_Aimbot"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Variáveis globais
local ESPBoxes = {}
local AimbotEnabled = false
local ESPEnabled = false
local FOVRadius = 100 -- Raio do círculo de FOV (pixéis)
local AimbotConnection

-- Criar Frame do menu
local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 320, 0, 280)
Frame.Position = UDim2.new(0.5, -160, 0.5, -140)
Frame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
Frame.BorderColor3 = Color3.fromRGB(255, 255, 255)
Frame.BorderSizePixel = 2
Frame.ZIndex = 10
Frame.Parent = ScreenGui
Frame.Active = true
Frame.Draggable = true

-- Título do menu
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1,0,0,35)
Title.Position = UDim2.new(0,0,0,0)
Title.BackgroundColor3 = Color3.fromRGB(30,30,30)
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 24
Title.Text = "Arsenal ESP & Aimbot"
Title.BorderSizePixel = 0
Title.ZIndex = 11
Title.Parent = Frame

-- Botão ESP
local ESPToggle = Instance.new("TextButton")
ESPToggle.Size = UDim2.new(0.8,0,0,40)
ESPToggle.Position = UDim2.new(0.1,0,0.18,0)
ESPToggle.Text = "ESP: OFF"
ESPToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
ESPToggle.TextColor3 = Color3.new(1,1,1)
ESPToggle.Font = Enum.Font.SourceSans
ESPToggle.TextSize = 20
ESPToggle.ZIndex = 11
ESPToggle.Parent = Frame

-- Botão Aimbot
local AimbotToggle = Instance.new("TextButton")
AimbotToggle.Size = UDim2.new(0.8,0,0,40)
AimbotToggle.Position = UDim2.new(0.1,0,0.4,0)
AimbotToggle.Text = "Aimbot: OFF"
AimbotToggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
AimbotToggle.TextColor3 = Color3.new(1,1,1)
AimbotToggle.Font = Enum.Font.SourceSans
AimbotToggle.TextSize = 20
AimbotToggle.ZIndex = 11
AimbotToggle.Parent = Frame

-- Label FOV
local FOVLabel = Instance.new("TextLabel")
FOVLabel.Size = UDim2.new(0.8, 0, 0, 20)
FOVLabel.Position = UDim2.new(0.1, 0, 0.62, 0)
FOVLabel.BackgroundTransparency = 1
FOVLabel.TextColor3 = Color3.new(1, 1, 1)
FOVLabel.Text = "Aimbot FOV: " .. tostring(FOVRadius)
FOVLabel.ZIndex = 11
FOVLabel.Parent = Frame

-- Input para modificar FOV
local FOVInput = Instance.new("TextBox")
FOVInput.Size = UDim2.new(0.8, 0, 0, 30)
FOVInput.Position = UDim2.new(0.1, 0, 0.68, 0)
FOVInput.Text = tostring(FOVRadius)
FOVInput.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
FOVInput.ClearTextOnFocus = false
FOVInput.TextColor3 = Color3.new(1,1,1)
FOVInput.Font = Enum.Font.SourceSans
FOVInput.TextSize = 20
FOVInput.ZIndex = 11
FOVInput.Parent = Frame

-- Círculo de FOV visível (contorno circular)
local FOVCircle = Instance.new("Frame")
FOVCircle.Size = UDim2.new(0, FOVRadius * 2, 0, FOVRadius * 2)
FOVCircle.Position = UDim2.new(0.5, -FOVRadius, 0.5, -FOVRadius)
FOVCircle.BackgroundTransparency = 1 -- fundo transparente
FOVCircle.BorderSizePixel = 2
FOVCircle.BorderColor3 = Color3.new(1,1,1)
FOVCircle.Visible = false
FOVCircle.ZIndex = 10
FOVCircle.Parent = ScreenGui

do
    -- Desenha o círculo com várias segmentações para borda fina
    local segments = 72
    local arcLength = 360 / segments
    local thickness = 1

    for i =1, segments do
        local segment = Instance.new("Frame")
        segment.Size = UDim2.new(0, thickness, 0, FOVRadius * math.pi * 2 / segments)
        segment.AnchorPoint = Vector2.new(0.5, 0)
        segment.Position = UDim2.new(0.5,0,0.5,0)
        segment.Rotation = arcLength * (i-1)
        segment.BackgroundColor3 = Color3.new(1,1,1)
        segment.BorderSizePixel = 0
        segment.ZIndex = 11
        segment.Parent = FOVCircle
    end
end

-- Funções auxiliares

local function IsSameTeam(p1, p2)
    return p1.Team ~= nil and p2.Team ~= nil and p1.Team == p2.Team
end

local function IsVisible(origin, targetPos)
    local direction = targetPos - origin
    local raycastParams = RaycastParams.new()
    raycastParams.FilterDescendantsInstances = {LocalPlayer.Character}
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    local raycastResult = Workspace:Raycast(origin, direction, raycastParams)
    if raycastResult then
        local distToHit = (raycastResult.Position - origin).Magnitude
        local distToTarget = direction.Magnitude
        if distToHit + 0.01 < distToTarget then
            return false -- obstáculo bloqueando
        else
            return true
        end
    else
        return true
    end
end

-- Atualiza ESP
local function UpdateESP(player)
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
        if ESPBoxes[player] then
            local data = ESPBoxes[player]
            data.Box.Visible = false
            data.NameTag.Visible = false
            data.DistanceText.Visible = false
        end
        return
    end

    local hrp = player.Character.HumanoidRootPart
    local screenPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
    if not onScreen then
        if ESPBoxes[player] then
            local data = ESPBoxes[player]
            data.Box.Visible = false
            data.NameTag.Visible = false
            data.DistanceText.Visible = false
        end
        return
    end

    local size = Vector3.new(4, 6, 4)
    local points = {
        Vector3.new(-size.X/2, size.Y/2, -size.Z/2),
        Vector3.new(size.X/2, size.Y/2, -size.Z/2),
        Vector3.new(size.X/2, -size.Y/2, -size.Z/2),
        Vector3.new(-size.X/2, -size.Y/2, -size.Z/2),
        Vector3.new(-size.X/2, size.Y/2, size.Z/2),
        Vector3.new(size.X/2, size.Y/2, size.Z/2),
        Vector3.new(size.X/2, -size.Y/2, size.Z/2),
        Vector3.new(-size.X/2, -size.Y/2, size.Z/2),
    }

    local screenCorners = {}
    for _, point in ipairs(points) do
        local worldPoint = hrp.CFrame:PointToWorldSpace(point)
        local sp, _ = Camera:WorldToViewportPoint(worldPoint)
        table.insert(screenCorners, Vector2.new(sp.X, sp.Y))
    end

    local minX, minY = math.huge, math.huge
    local maxX, maxY = -math.huge, -math.huge
    for _, p in ipairs(screenCorners) do
        if p.X < minX then minX = p.X end
        if p.Y < minY then minY = p.Y end
        if p.X > maxX then maxX = p.X end
        if p.Y > maxY then maxY = p.Y end
    end

    if not ESPBoxes[player] then
        local box = Instance.new("Frame")
        box.BorderSizePixel = 2
        box.BackgroundTransparency = 0.7
        box.ZIndex = 5
        box.Parent = ScreenGui

        local nameTag = Instance.new("TextLabel")
        nameTag.Size = UDim2.new(0, 100, 0, 25)
        nameTag.BackgroundTransparency = 1
        nameTag.TextColor3 = Color3.new(1, 1, 1)
        nameTag.TextStrokeTransparency = 0
        nameTag.TextScaled = true
        nameTag.ZIndex = 5
        nameTag.Parent = ScreenGui

        local distanceText = Instance.new("TextLabel")
        distanceText.Size = UDim2.new(0, 100, 0, 20)
        distanceText.BackgroundTransparency = 1
        distanceText.TextColor3 = Color3.new(1, 1, 1)
        distanceText.TextStrokeTransparency = 0
        distanceText.TextScaled = true
        distanceText.ZIndex = 5
        distanceText.Parent = ScreenGui

        ESPBoxes[player] = {
            Box = box,
            NameTag = nameTag,
            DistanceText = distanceText,
        }
    end

    local data = ESPBoxes[player]

    if IsSameTeam(player, LocalPlayer) then
        data.Box.BackgroundColor3 = Color3.fromRGB(0, 102, 255) -- azul translúcido
        data.Box.BorderColor3 = Color3.fromRGB(50, 150, 255)
    else
        data.Box.BackgroundColor3 = Color3.fromRGB(255, 0, 0) -- vermelho translúcido
        data.Box.BorderColor3 = Color3.fromRGB(255, 80, 80)
    end

    data.Box.Position = UDim2.new(0, minX, 0, minY)
    data.Box.Size = UDim2.new(0, maxX - minX, 0, maxY - minY)
    data.Box.Visible = ESPEnabled

    data.NameTag.Position = UDim2.new(0, minX, 0, minY - 25)
    data.NameTag.Size = UDim2.new(0, maxX - minX, 0, 25)
    data.NameTag.Text = player.Name
    data.NameTag.Visible = ESPEnabled

    local dist = (LocalPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
    data.DistanceText.Position = UDim2.new(0, minX, 0, maxY + 2)
    data.DistanceText.Size = UDim2.new(0, maxX - minX, 0, 20)
    data.DistanceText.Text = string.format("%.1f studs", dist)
    data.DistanceText.Visible = ESPEnabled
end

-- Remove ESP ao sair do jogador
Players.PlayerRemoving:Connect(function(player)
    if ESPBoxes[player] then
        local data = ESPBoxes[player]
        data.Box:Destroy()
        data.NameTag:Destroy()
        data.DistanceText:Destroy()
        ESPBoxes[player] = nil
    end
end)

-- Checa se uma posição está dentro do círculo de FOV (em pixels)
local function IsInFOV(worldPos)
    local screenPos, onScreen = Camera:WorldToViewportPoint(worldPos)
    if not onScreen then return false end
    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    local point2D = Vector2.new(screenPos.X, screenPos.Y)
    return (point2D - center).Magnitude <= FOVRadius
end

-- Aimbot mira inimigos visíveis (sem obstáculos) dentro do FOV circular
local function Aimbot()
    if not AimbotEnabled then return end
    if not (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) then return end

    local origin = LocalPlayer.Character.HumanoidRootPart.Position
    local closestDist = math.huge
    local targetPlayer = nil

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            if not IsSameTeam(player, LocalPlayer) then
                local hrp = player.Character.HumanoidRootPart
                if IsInFOV(hrp.Position) then
                    if IsVisible(origin, hrp.Position) then
                        local dist = (origin - hrp.Position).Magnitude
                        if dist < closestDist then
                            closestDist = dist
                            targetPlayer = player
                        end
                    end
                end
            end
        end
    end

    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local targetPos = targetPlayer.Character.HumanoidRootPart.Position
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPos)
    end
end

-- Ligar/Desligar ESP
local function ToggleESP()
    ESPEnabled = not ESPEnabled
    ESPToggle.Text = "ESP: " .. (ESPEnabled and "ON" or "OFF")
    if not ESPEnabled then
        for _, data in pairs(ESPBoxes) do
            data.Box.Visible = false
            data.NameTag.Visible = false
            data.DistanceText.Visible = false
        end
    end
end

-- Ligar/Desligar Aimbot
local function ToggleAimbot()
    AimbotEnabled = not AimbotEnabled
    AimbotToggle.Text = "Aimbot: " .. (AimbotEnabled and "ON" or "OFF")
    FOVCircle.Visible = AimbotEnabled

    if AimbotEnabled then
        if not AimbotConnection then
            AimbotConnection = RunService.RenderStepped:Connect(Aimbot)
        end
    else
        if AimbotConnection then
            AimbotConnection:Disconnect()
            AimbotConnection = nil
        end
    end
end

-- Atualiza FOV com input do usuário no textbox (limita entre 10 e 600)
FOVInput.FocusLost:Connect(function(enter)
    if not enter then return end
    local val = tonumber(FOVInput.Text)
    if val and val >= 10 and val <= 600 then
        FOVRadius = val
        FOVLabel.Text = "Aimbot FOV: " .. tostring(FOVRadius)
        FOVCircle.Size = UDim2.new(0, FOVRadius * 2, 0, FOVRadius * 2)
        FOVCircle.Position = UDim2.new(0.5, -FOVRadius, 0.5, -FOVRadius)
        -- Apaga bordas antigas
        for _, child in pairs(FOVCircle:GetChildren()) do if child:IsA("Frame") then child:Destroy() end end
        
        -- Redesenha círculo com segmentos finos
        local segments = 72
        local arcLength = 360 / segments
        local thickness = 1

        for i =1, segments do
            local segment = Instance.new("Frame")
            segment.Size = UDim2.new(0, thickness, 0, FOVRadius * math.pi * 2 / segments)
            segment.AnchorPoint = Vector2.new(0.5, 0)
            segment.Position = UDim2.new(0.5, 0, 0.5, 0)
            segment.Rotation = arcLength * (i-1)
            segment.BackgroundColor3 = Color3.new(1,1,1)
            segment.BorderSizePixel = 0
            segment.ZIndex = 11
            segment.Parent = FOVCircle
        end
    else
        FOVInput.Text = tostring(FOVRadius)
    end
end)

-- Atualiza ESP continuamente
RunService.RenderStepped:Connect(function()
    for _, player in pairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            UpdateESP(player)
        elseif ESPBoxes[player] then
            local data = ESPBoxes[player]
            data.Box.Visible = false
            data.NameTag.Visible = false
            data.DistanceText.Visible = false
        end
    end
end)

-- Conecta eventos dos botões do menu
ESPToggle.MouseButton1Click:Connect(ToggleESP)
AimbotToggle.MouseButton1Click:Connect(ToggleAimbot)

print("Script Arsenal ESP + Aimbot com FOV visível e mira só em inimigos
